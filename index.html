<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kali Secure Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    font-family: "Courier New", monospace;
    background: #0b0f0c;
    color: #00ff88;
}

.container {
    max-width: 800px;
    margin: auto;
    padding: 20px;
}

h1 {
    text-align: center;
    text-shadow: 0 0 10px #00ff88;
}

input, button {
    width: 100%;
    padding: 12px;
    margin-top: 10px;
    background: #020403;
    border: 1px solid #00ff88;
    color: #00ff88;
    font-family: inherit;
}

button {
    cursor: pointer;
}

button:hover {
    background: #00ff88;
    color: #000;
}

.hidden {
    display: none;
}

#chatBox {
    height: 350px;
    overflow-y: auto;
    border: 1px solid #00ff88;
    padding: 10px;
    margin-bottom: 10px;
    background: #020403;
}

.msg {
    margin-bottom: 8px;
}

.user {
    color: #00ffaa;
}
</style>
</head>

<body>

<div class="container">
<h1>ðŸ’€ Kali Secure Chat</h1>

<!-- LOGIN -->
<div id="loginBox">
    <input type="email" id="email" placeholder="email@domain.com">
    <input type="password" id="password" placeholder="password">
    <button onclick="login()">Login</button>
    <button onclick="register()">Register</button>
</div>

<!-- CHAT -->
<div id="chatBoxUI" class="hidden">
    <div id="chatBox"></div>
    <input type="text" id="message" placeholder="Type message...">
    <button onclick="sendMessage()">Send</button>
    <button onclick="logout()">Logout</button>
</div>
</div>

<!-- Firebase SDKs (COMPAT ONLY) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* ðŸ”¥ Firebase Config */
const firebaseConfig = {
  apiKey: "AIzaSyCPtbRGBA70RVc__8zGMPwv8ADSYbGl9Bc",
  authDomain: "chat-abc20.firebaseapp.com",
  projectId: "chat-abc20",
  storageBucket: "chat-abc20.appspot.com",
  messagingSenderId: "621608777112",
  appId: "1:621608777112:web:7f7a37c0473c99ed8627ed"
};

/* Initialize Firebase */
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

/* Auth State */
auth.onAuthStateChanged(user => {
    if (user) {
        loginBox.classList.add("hidden");
        chatBoxUI.classList.remove("hidden");
        loadMessages();
    } else {
        loginBox.classList.remove("hidden");
        chatBoxUI.classList.add("hidden");
    }
});

/* Login */
function login() {
    auth.signInWithEmailAndPassword(
        email.value,
        password.value
    ).catch(err => alert(err.message));
}

/* Register */
function register() {
    auth.createUserWithEmailAndPassword(
        email.value,
        password.value
    ).catch(err => alert(err.message));
}

/* Logout */
function logout() {
    auth.signOut();
}

/* Send Message */
function sendMessage() {
    if (!message.value) return;

    db.collection("messages").add({
        text: message.value,
        user: auth.currentUser.email,
        time: firebase.firestore.FieldValue.serverTimestamp()
    });

    message.value = "";
}

/* Load Messages */
function loadMessages() {
    db.collection("messages")
    .orderBy("time")
    .onSnapshot(snapshot => {
        chatBox.innerHTML = "";
        snapshot.forEach(doc => {
            const data = doc.data();
            chatBox.innerHTML += `
              <div class="msg">
                <span class="user">[${data.user}]</span> ${data.text}
              </div>`;
        });
        chatBox.scrollTop = chatBox.scrollHeight;
    });
}
</script>

</body>
</html>
